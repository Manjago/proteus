# Proteus: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

> –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∞.
> –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –∫–æ–¥–æ–º.

## 1. –û–±–∑–æ—Ä

**Proteus** ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–π –∂–∏–∑–Ω–∏, –≤–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–æ–π [Tierra](https://en.wikipedia.org/wiki/Tierra_(computer_simulation)) –¢–æ–º–∞—Å–∞ –†—ç—è (1991).

–û—Ä–≥–∞–Ω–∏–∑–º—ã ‚Äî —ç—Ç–æ —Å–∞–º–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—â–∏–µ—Å—è –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∂–∏–≤—É—â–∏–µ –≤ –æ–±—â–µ–π –ø–∞–º—è—Ç–∏ ("—Å—É–ø–µ"). –û–Ω–∏ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ —Ä–µ—Å—É—Ä—Å—ã (–ø–∞–º—è—Ç—å, CPU-–≤—Ä–µ–º—è), –º—É—Ç–∏—Ä—É—é—Ç –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É—é—Ç.

### –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã Tierra –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ (Java 21+)
- –ù–∞–±–ª—é–¥–∞—Ç—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –ø–∞—Ä–∞–∑–∏—Ç–æ–≤, –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–∑–∏—Ç–æ–≤ –∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º
- –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —ç–≤–æ–ª—é—Ü–∏–∏

### –û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π Tierra

| –ê—Å–ø–µ–∫—Ç | Tierra (1991) | Proteus |
|--------|---------------|---------|
| –Ø–∑—ã–∫ | C | Java 21+ |
| ISA | 32 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | 17 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (ISA v1.2) |
| –ê–¥—Ä–µ—Å–∞—Ü–∏—è | Template-based | –ü—Ä—è–º–∞—è + Template (SEARCH) |
| –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã | –¢–æ–ª—å–∫–æ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ | MOVI (21-bit immediate) |
| –ö–æ–¥ | –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ | Position-Independent (v1.2) |

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      CLI (picocli)                          ‚îÇ
‚îÇ              run | disassemble | ancestor | info            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SimulatorConfig (HOCON)  ‚îÇ  SimulatorListener (events)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ                    Simulator                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - run(), stop(), seedAdam()                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - aliveOrganisms[], organisms[]                    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - MutationTracker, Defragmenter                    ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ         ‚îÇ                      ‚îÇ                    ‚îÇ       ‚îÇ
‚îÇ         ‚ñº                      ‚ñº                    ‚ñº       ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ    ‚îÇ  VirtualCPU ‚îÇ    ‚îÇ   Reaper    ‚îÇ    ‚îÇ MemoryMgr   ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - execute() ‚îÇ    ‚îÇ - reap()    ‚îÇ    ‚îÇ - allocate()‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - mutations ‚îÇ    ‚îÇ - lazy del  ‚îÇ    ‚îÇ - free()    ‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ - rebuild() ‚îÇ    ‚îÇ
‚îÇ           ‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ           ‚ñº                                                 ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ    ‚îÇ  CpuState   ‚îÇ    ‚îÇ  Organism   ‚îÇ    ‚îÇDefragmenter ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - regs[8]   ‚îÇ    ‚îÇ - id, addr  ‚îÇ    ‚îÇ - compact() ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - IP (rel)  ‚îÇ    ‚îÇ - size      ‚îÇ    ‚îÇ - 2-pass    ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - startAddr ‚îÇ    ‚îÇ - alive     ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ - pending   ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                        int[] soup                           ‚îÇ
‚îÇ           "Soup" (10K-1M cells, plain array)                ‚îÇ
‚îÇ              Single-threaded for determinism                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã

#### Core (—è–¥—Ä–æ —Å–∏–º—É–ª—è—Ü–∏–∏)

| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `OpCode` | Enum –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π + encoding/decoding |
| `CpuState` | –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (—Ä–µ–≥–∏—Å—Ç—Ä—ã, IP, startAddr, pending allocation + allocId) |
| `VirtualCPU` | –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –º—É—Ç–∞—Ü–∏–∏ –ø—Ä–∏ COPY |
| `SystemCallHandler` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è ALLOCATE, SPAWN, freePending, getLastAllocId |
| `Organism` | –û—Ä–≥–∞–Ω–∏–∑–º: –≥–µ–Ω–æ–º, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, lifecycle, allocId –¥–ª—è safe cleanup |
| `MemoryManager` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é (allocate/free/rebuild/freeByAllocId) |
| `BitmapMemoryManager` | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: ownership array, single source of truth, allocId tracking |
| `Reaper` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∂–Ω–µ—Ü–∞ (—É–±–∏–π—Å—Ç–≤–æ + –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ) |
| `AgeBasedReaper` | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: lazy deletion, —É–±–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä–µ–π—à–∏—Ö, freeByAllocId |
| `Defragmenter` | –ö–æ–º–ø–∞–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ (two-pass algorithm), –æ–±–Ω–æ–≤–ª—è–µ—Ç allocId |
| `MutationTracker` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º—É—Ç–∞—Ü–∏–π –ø—Ä–∏ COPY |
| `Disassembler` | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –º–Ω–µ–º–æ–Ω–∏–∫–∏ |
| `GenomeBuilder` | Fluent API –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –≥–µ–Ω–æ–º–æ–≤ |
| `Adam` | –ü–µ—Ä–≤—ã–π —Å–∞–º–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—â–∏–π—Å—è –æ—Ä–≥–∞–Ω–∏–∑–º (14 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, v3) |

#### Application (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `SimulatorConfig` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (HOCON, typesafe-config) |
| `Simulator` | –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ |
| `SimulatorStats` | –°–Ω–∏–º–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤–∫–ª—é—á–∞—è memoryLeak, maxAlive) |
| `SimulatorListener` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–±—ã—Ç–∏–π (spawn, death, checkpoint) |
| `DeathCause` | Enum –ø—Ä–∏—á–∏–Ω —Å–º–µ—Ä—Ç–∏ (ERRORS, REAPED) |

#### CLI (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `ProteusCli` | –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (picocli) |
| `RunCommand` | –ö–æ–º–∞–Ω–¥–∞ `run` ‚Äî –∑–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ (+ --resume, --save) |
| `DebugCommand` | –ö–æ–º–∞–Ω–¥–∞ `debug` ‚Äî –ø–æ–∫–∞–¥—Ä–æ–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (+ --resume, --save) |
| `CheckpointCommand` | –ö–æ–º–∞–Ω–¥–∞ `checkpoint` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å checkpoint —Ñ–∞–π–ª–∞–º–∏ |
| `AssembleCommand` | –ö–æ–º–∞–Ω–¥–∞ `assemble` ‚Äî –∞—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ .asm —Ñ–∞–π–ª–æ–≤ |
| `DisassembleCommand` | –ö–æ–º–∞–Ω–¥–∞ `disassemble` ‚Äî –¥–∏–∑–∞—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `AncestorCommand` | –ö–æ–º–∞–Ω–¥–∞ `ancestor` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≥–µ–Ω–æ–º Adam |
| `InfoCommand` | –ö–æ–º–∞–Ω–¥–∞ `info` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ |

#### Persistence (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è)

| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `CheckpointStore` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (H2 MVStore) |
| `GameRng` | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω—ã–π RNG —Å save/restore (Apache Commons RNG) |
| `GameRngState` | –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ RNG |

#### Debug (–æ—Ç–ª–∞–¥–∫–∞)

| –ö–ª–∞—Å—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-------|-----------------|
| `Frame` | –°–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ |
| `FrameRecorder` | –ó–∞–ø–∏—Å—å —Ñ—Ä–µ–π–º–æ–≤ –≤–æ –≤—Ä–µ–º—è —Å–∏–º—É–ª—è—Ü–∏–∏ |
| `FramePrinter` | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ñ—Ä–µ–π–º–æ–≤ |

---

## 3. –ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (ISA v1.2)

–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: [ISA_SPEC.md](ISA_SPEC.md)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v1.2 (Position-Independent Code)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | v1.1 | v1.2 |
|-----------|------|------|
| **JMP/JMPZ/JLT** | –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö | IP-relative offset (18-bit signed) |
| **LOAD/STORE** | –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è | startAddr-relative (—Å–≤–æ—è –ø–∞–º—è—Ç—å) |
| **GETADDR** | ‚Äî | –ù–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π startAddr |
| **Adam** | 13 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ JMP | 14 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, position-independent |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PIC

1. **–î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–º—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏ –±–µ–∑ –ø–∞—Ç—á–∏–Ω–≥–∞ –∫–æ–¥–∞
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å** ‚Äî –ø–æ—Ç–æ–º–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ª—é–±–æ–≥–æ –∞–¥—Ä–µ—Å–∞
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –Ω–µ –Ω—É–∂–Ω—ã —Ä–µ–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏

### –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ |
|-----------|------------|
| –ë–∞–∑–æ–≤—ã–µ | `NOP`, `MOV`, `MOVI`, `GETADDR` |
| –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ | `ADD`, `SUB`, `INC`, `DEC` |
| –ü–∞–º—è—Ç—å (relative) | `LOAD`, `STORE` |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (IP-relative) | `JMP offset`, `JMPZ R, offset`, `JLT Ra, Rb, offset` |
| –°–∏—Å—Ç–µ–º–Ω—ã–µ (absolute) | `COPY`, `ALLOCATE`, `SPAWN` |
| –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ | `SEARCH` |

### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (32 –±–∏—Ç–∞):**
```
[8 bits: OpCode | 3 bits: R1 | 3 bits: R2 | 3 bits: R3 | 3 bits: R4 | 12 bits: reserved]
```

**–§–æ—Ä–º–∞—Ç MOVI:**
```
[8 bits: OpCode | 3 bits: R_dst | 21 bits: immediate (unsigned)]
```

**–§–æ—Ä–º–∞—Ç JMP/JMPZ/JLT (v1.2):**
```
[8 bits: OpCode | 3 bits: R_cond1 | 3 bits: R_cond2 | 18 bits: offset (signed)]
```

---

## 4. –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –¥–∏–∑–∞–π–Ω-—Ä–µ—à–µ–Ω–∏—è

### 4.1. –ú—É—Ç–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ COPY ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:** –ú—É—Ç–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –¢–û–õ–¨–ö–û –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `COPY`.

**–ü–æ—á–µ–º—É:**
- –ë–∏–æ–ª–æ–≥–∏—á–Ω–µ–µ ‚Äî –º—É—Ç–∞—Ü–∏–∏ –≤ –ø—Ä–∏—Ä–æ–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –î–ù–ö
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–µ–µ ‚Äî –ª–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ ‚Äî –Ω–µ –Ω—É–∂–µ–Ω —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –º—É—Ç–∞—Ü–∏–π

```java
// VirtualCPU.java
case COPY -> {
    int value = memory[srcAddr];
    if (random.nextDouble() < mutationRate) {
        value = mutate(value);  // ‚Üê –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –º—É—Ç–∞—Ü–∏–π!
    }
    memory[dstAddr] = value;
}
```

### 4.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –ø–∞–º—è—Ç–∏ ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:** –û—Ä–≥–∞–Ω–∏–∑–º—ã –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å –õ–Æ–ë–£–Æ —è—á–µ–π–∫—É –ø–∞–º—è—Ç–∏.

**–ü–æ—á–µ–º—É —ç—Ç–æ –§–ò–ß–ê, –∞ –Ω–µ –±–∞–≥:**
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ **–ø–∞—Ä–∞–∑–∏—Ç–æ–≤** (–∏—Å–ø–æ–ª—å–∑—É—é—Ç —á—É–∂–æ–π –∫–æ–¥)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç **—Ö–∏—â–Ω–∏—á–µ—Å—Ç–≤–æ** (–ø–æ—Ä—Ç—è—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤)
- –°–æ–∑–¥–∞—ë—Ç **—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ** –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É
- –¢–∞–∫ –±—ã–ª–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π Tierra

### 4.3. Round-Robin –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–≤–Ω–æ 1 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∑–∞ —Ü–∏–∫–ª.

**–ü–æ—á–µ–º—É:**
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ß–µ—Å—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ CPU
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å (–≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

### 4.4. –°–º–µ—Ä—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—à–∏–±–æ–∫ ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:** –û—Ä–≥–∞–Ω–∏–∑–º —É–º–∏—Ä–∞–µ—Ç –ø–æ—Å–ª–µ 100 –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `ERROR_IP_OUT_OF_BOUNDS` ‚Äî IP –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ø–∞–º—è—Ç–∏
- `ERROR_UNKNOWN_OPCODE` ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `ERROR_MEMORY_OUT_OF_BOUNDS` ‚Äî —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏

### 4.5. Pending Allocation Tracking ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–∏:
- –î–≤–æ–π–Ω–æ–º ALLOCATE –±–µ–∑ SPAWN –º–µ–∂–¥—É –Ω–∏–º–∏
- –°–º–µ—Ä—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –¥–æ SPAWN
- SPAWN —Å –º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º/—Ä–∞–∑–º–µ—Ä–æ–º
- –û—Ä–≥–∞–Ω–∏–∑–º –ø–∏—à–µ—Ç –ø–æ–≤–µ—Ä—Ö —á—É–∂–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏ COPY

**–†–µ—à–µ–Ω–∏–µ:** CpuState –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç pending allocation —Å allocId:

```java
// CpuState
private int pendingAllocAddr = -1;
private int pendingAllocSize = 0;
private int pendingAllocId = -1;  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è safe cleanup

// –ü—Ä–∏ ALLOCATE
if (hasPendingAllocation()) {
    syscallHandler.freePending(pendingAddr, pendingSize, pendingAllocId);
}
state.setPendingAllocation(addr, size, allocId);

// –ü—Ä–∏ SPAWN
if (!memoryManager.hasConsistentOwnership(pendingAddr, pendingSize)) {
    // –û—Ä–≥–∞–Ω–∏–∑–º –∑–∞–ª–µ–∑ –Ω–∞ —á—É–∂—É—é –ø–∞–º—è—Ç—å –ø—Ä–∏ COPY!
    memoryManager.freeByAllocId(pendingAddr, pendingSize, pendingAllocId);
    reject spawn;
}

if (address != pendingAddr) {
    reject + free pending;  // –ú—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å!
}
actualSize = pendingSize;  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä, –Ω–µ –º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π

// –ü—Ä–∏ —Å–º–µ—Ä—Ç–∏
if (state.hasPendingAllocation()) {
    memoryManager.freeByAllocId(pendingAddr, pendingSize, pendingAllocId);
}
if (org.getAllocId() >= 0) {
    memoryManager.freeByAllocId(org.getStartAddr(), org.getSize(), org.getAllocId());
}
```

**Organism.allocId:**

–ö–∞–∂–¥—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–π `allocId` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏:
- –ü—Ä–∏ spawn: `allocId` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–∑ pending allocation
- –ü—Ä–∏ defrag: `allocId` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ `markUsed()`
- –ü—Ä–∏ death/reap: `freeByAllocId()` –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —è—á–µ–π–∫–∏

### 4.6. –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω—ã–π Random (GameRng) ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** java.util.Random –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è checkpoint.

**–†–µ—à–µ–Ω–∏–µ:** Apache Commons RNG —Å —è–≤–Ω—ã–º save/restore:

```java
// –°–æ–∑–¥–∞–Ω–∏–µ
GameRng rng = new GameRng(seed);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (API —Å–æ–≤–º–µ—Å—Ç–∏–º —Å Random)
double d = rng.nextDouble();
int i = rng.nextInt(100);

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
GameRng.GameRngState state = rng.saveState();
byte[] bytes = state.toBytes();  // –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
GameRngState loaded = GameRngState.fromBytes(bytes);
GameRng restored = GameRng.restore(loaded);
```

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º `XO_RO_SHI_RO_128_PP` ‚Äî –ù–ï –ú–ï–ù–Ø–¢–¨ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏!
- State —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ü–ï–†–ï–î –ª—é–±—ã–º–∏ random-–≤—ã–∑–æ–≤–∞–º–∏ –≤ checkpoint
- –ü—Ä–∏ resume: `--seed` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è state –∏–∑ checkpoint

### 4.7. Lazy Deletion –≤ Reaper ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** `PriorityQueue.remove()` = O(n) ‚Äî —É–±–∏–π—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏ –º–∏–ª–ª–∏–æ–Ω–∞—Ö –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –ù–µ —É–¥–∞–ª—è–µ–º –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø—Ä–∏ unregister(), –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –º—ë—Ä—Ç–≤—ã—Ö –ø—Ä–∏ reap():

```java
public void unregister(Organism org) {
    // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º! Lazy deletion.
}

public Organism reap() {
    while (!queue.isEmpty()) {
        Organism candidate = queue.poll();
        if (candidate.isAlive()) {  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º—ë—Ä—Ç–≤—ã—Ö
            // Kill and return
        }
    }
}
```

**Periodic Cleanup:** –ö–∞–∂–¥—ã–µ 10,000 —Ü–∏–∫–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏:
```java
if (rawQueueSize > aliveCount * 2 + 10_000) {
    reaper.cleanup();  // removeIf(!isAlive)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ unregister(): O(n) ‚Üí O(1)
- ‚úÖ cleanup(): O(n) –Ω–æ —Ä–µ–¥–∫–æ (–∫–∞–∂–¥—ã–µ 10K+ —Ü–∏–∫–ª–æ–≤)
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç OOM –æ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –º—ë—Ä—Ç–≤—ã—Ö

### 4.7. Memory Optimization ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** `List<Organism> organisms` —Ö—Ä–∞–Ω–∏–ª –í–°–ï –∫–æ–≥–¥–∞-–ª–∏–±–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º—ã.
- 3.5M spawns √ó ~100 bytes/Organism = 350+ MB —É—Ç–µ—á–∫–∞!

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—á—ë—Ç—á–∏–∫:
```java
// –ë—ã–ª–æ:
private final List<Organism> organisms = new ArrayList<>();
organisms.add(child);
int id = organisms.size();

// –°—Ç–∞–ª–æ:
private int totalOrganismsCreated = 0;
totalOrganismsCreated++;
int id = totalOrganismsCreated;
```

**–ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏:**
- `aliveOrganisms` ‚Äî —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã–µ (max 5,000)
- Reaper queue ‚Äî –∂–∏–≤—ã–µ + –º—ë—Ä—Ç–≤—ã–µ (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∏—Ç—Å—è)
- `MutationTracker` ‚Äî –≤—Å–µ –º—É—Ç–∞—Ü–∏–∏ (~100K –∑–∞–ø–∏—Å–µ–π ‚âà 5MB)

### 4.8. –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:** –í—Å—è —Å–∏–º—É–ª—è—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ. Soup ‚Äî –æ–±—ã—á–Ω—ã–π `int[]`, –Ω–µ `AtomicIntegerArray`.

**–ü–æ—á–µ–º—É:**
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º** ‚Äî –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º seed –ø–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –Ω–µ—Ç race conditions, –ø—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
- **Checkpoint** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ RNG –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ—Ç overhead'–∞ –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (~6x –±—ã—Å—Ç—Ä–µ–µ)

```java
// Simulator.java
private final int[] soup;  // Plain array, NOT AtomicIntegerArray

public Simulator(SimulatorConfig config) {
    this.soup = new int[config.soupSize()];  // ~4MB for 1M cells
    // ...
}
```

**–ü–æ—Ç–æ–∫–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:**
- `main` ‚Äî –≤—Å—è –ª–æ–≥–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ (–æ–¥–∏–Ω —Ü–∏–∫–ª = –æ–¥–∏–Ω –ø–æ—Ç–æ–∫)
- UI/CLI ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç soup

---

## 5. Adam ‚Äî –ø–µ—Ä–≤—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º

Adam ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–∞–º–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—â–∏–π—Å—è –æ—Ä–≥–∞–Ω–∏–∑–º. –≠—Ç–æ "–ø—Ä–µ–¥–æ–∫", –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

### –ì–µ–Ω–æ–º v3 (14 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, Position-Independent)

```asm
; –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
0000: MOVI R4, 14       ; R4 = SIZE
0001: GETADDR R7        ; R7 = –º–æ–π –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –∞–¥—Ä–µ—Å

; –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
0002: ALLOCATE R4, R3   ; R3 = –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ—Ç–æ–º–∫–∞

; –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π
0003: MOV R5, R7        ; R5 = src pointer (–º–æ–π —Å—Ç–∞—Ä—Ç)
0004: MOV R6, R3        ; R6 = dst pointer (—Å—Ç–∞—Ä—Ç –ø–æ—Ç–æ–º–∫–∞)
0005: MOVI R0, 0        ; R0 = counter

; –¶–∏–∫–ª –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (–∞–¥—Ä–µ—Å 6)
0006: COPY [R5], [R6]   ; –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å –º—É—Ç–∞—Ü–∏–µ–π!
0007: INC R5            ; src++
0008: INC R6            ; dst++
0009: INC R0            ; counter++
000A: JLT R0, R4, -5   ; if counter < SIZE, goto 6

; –ü–æ—Ä–æ–∂–¥–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä
000B: SPAWN R3, R4      ; –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–º–∫–∞
000C: MOVI R0, 0        ; Reset counter
000D: JMP -12           ; goto 2 (ALLOCATE)
```

### –†–µ–≥–∏—Å—Ç—Ä—ã (v3)

| –†–µ–≥–∏—Å—Ç—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| R0 | Counter (0 to size-1) |
| R3 | –ê–¥—Ä–µ—Å –ø–æ—Ç–æ–º–∫–∞ (–æ—Ç ALLOCATE) |
| R4 | –†–∞–∑–º–µ—Ä –≥–µ–Ω–æ–º–∞ (14) |
| R5 | Source pointer (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è) |
| R6 | Destination pointer (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è) |
| R7 | –ú–æ–π startAddr (–æ—Ç GETADDR) |

---

## 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

### 6.1. BitmapMemoryManager (Single Source of Truth)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ö–∞–∂–¥–∞—è —è—á–µ–π–∫–∞ –ø–∞–º—è—Ç–∏ –∑–Ω–∞–µ—Ç —Å–≤–æ–µ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞.

```java
int[] ownership = new int[soupSize];
// ownership[i] = -1 (FREE) –∏–ª–∏ allocId (–∑–∞–Ω—è—Ç–æ)
```

**allocId Tracking:**

–ö–∞–∂–¥–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `allocId`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –¢–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ —è—á–µ–π–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–∞–∫–æ–º—É –æ—Ä–≥–∞–Ω–∏–∑–º—É
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —è—á–µ–π–∫–∏ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å pending allocations –ø—Ä–∏ reject spawn

```java
// –ü—Ä–∏ ALLOCATE
int addr = memoryManager.allocate(size);
int allocId = memoryManager.getLastAllocId();
state.setPendingAllocation(addr, size, allocId);

// –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω–æ–º SPAWN (–Ω–∞–ø—Ä–∏–º–µ—Ä, organism wrote over alien memory)
if (!hasConsistentOwnership(addr, size)) {
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –°–í–û–ò —è—á–µ–π–∫–∏
    memoryManager.freeByAllocId(addr, size, allocId);
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ Free List:**

| –ü—Ä–æ–±–ª–µ–º–∞ Free List | –†–µ—à–µ–Ω–∏–µ –≤ Bitmap |
|-------------------|------------------|
| Double-free ‚Üí –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å | free() –Ω–∞ FREE —è—á–µ–π–∫—É = no-op |
| –°–ª–æ–∂–Ω—ã–π merge/split –±–ª–æ–∫–æ–≤ | –ù–µ—Ç –±–ª–æ–∫–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ —è—á–µ–π–∫–∏ |
| –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é | ownership IS —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å |
| –°–ª–æ–∂–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ | –ú–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å ownership |
| –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —á—É–∂–æ–π –ø–∞–º—è—Ç–∏ | freeByAllocId() –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ |

**–û–ø–µ—Ä–∞—Ü–∏–∏:**

| –ú–µ—Ç–æ–¥ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|----------|
| `allocate(size)` | O(n) worst | Next-fit scan, –ø–æ–º–µ—á–∞–µ—Ç allocId |
| `free(addr, size)` | O(size) | –ü–æ–º–µ—á–∞–µ—Ç FREE (no-op –µ—Å–ª–∏ —É–∂–µ FREE) |
| `freeByAllocId(addr, size, id)` | O(size) | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —è—á–µ–π–∫–∏ —Å –¥–∞–Ω–Ω—ã–º allocId |
| `freeIfOwned(addr, size)` | O(size) | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –µ—Å–ª–∏ –≤–µ—Å—å –±–ª–æ–∫ –æ–¥–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| `hasConsistentOwnership(addr, size)` | O(size) | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤–µ—Å—å –±–ª–æ–∫ –æ–¥–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| `getUsedMemory()` | O(n) | –°—á–∏—Ç–∞–µ—Ç –Ω–µ-FREE —è—á–µ–π–∫–∏ |
| `rebuild(usedEnd)` | O(n) | –û—á–∏—â–∞–µ—Ç –≤—Å—ë + —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç nextFitPosition |
| `markUsed(addr, size)` | O(size) | –ü–æ–º–µ—á–∞–µ—Ç –∑–∞–Ω—è—Ç—ã–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç allocId |
| `getLastAllocId()` | O(1) | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç allocId –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–ª–ª–æ–∫–∞—Ü–∏–∏ |

**Next-Fit Allocation:**
```java
// –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–ª–ª–æ–∫–∞—Ü–∏–∏
nextFitPosition = allocatedEnd;

// –°–ª–µ–¥—É—é—â–∏–π allocate –Ω–∞—á–∏–Ω–∞–µ—Ç —Å —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
// –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - wrap around –∫ –Ω–∞—á–∞–ª—É
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –ø–æ–ø—É–ª—è—Ü–∏–∏ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –∏–¥—É—Ç "–≤–ø–µ—Ä—ë–¥" –ø–æ –ø–∞–º—è—Ç–∏, –∏–∑–±–µ–≥–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–Ω—è—Ç—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π –≤ –Ω–∞—á–∞–ª–µ. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é O(n) ‚Üí O(1) –≤ —Ç–∏–ø–∏—á–Ω–æ–º —Å–ª—É—á–∞–µ.

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ `getUsedMemory() >= 0` –í–°–ï–ì–î–ê
- ‚úÖ `getUsedMemory() + getFreeMemory() == getTotalMemory()` –í–°–ï–ì–î–ê
- ‚úÖ Double-free –±–µ–∑–æ–ø–∞—Å–µ–Ω (–ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
- ‚úÖ freeByAllocId() –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç —á—É–∂—É—é –ø–∞–º—è—Ç—å

### 6.2. –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è

**–ú–µ—Ç—Ä–∏–∫–∞:**
```
fragmentation = 1 - (largestFreeBlock / totalFreeMemory)
```

### 6.3. –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (Defragmenter)

**–ê–ª–≥–æ—Ä–∏—Ç–º —Å BitmapMemoryManager:**

```
1. rebuild(0) ‚Äî –æ—á–∏—â–∞–µ—Ç –í–°–Æ ownership
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–º–∞:
   a. –ö–æ–ø–∏—Ä—É–µ–º –≥–µ–Ω–æ–º –≤ –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
   b. int newAllocId = markUsed(newAddr, size) ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–π
   c. org.setAllocId(newAllocId) ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º allocId –æ—Ä–≥–∞–Ω–∏–∑–º–∞!
3. –í—Å—ë —á—Ç–æ –Ω–µ –ø–æ–º–µ—á–µ–Ω–æ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ FREE
```

**–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã–µ allocId –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã. 
`markUsed()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π allocId –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –æ—Ä–≥–∞–Ω–∏–∑–º—É.

**Position-Independence –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç** –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.

---

## 7. Reaper (–ñ–Ω–µ—Ü)

### 7.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Reaper ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º "—Å–º–µ—Ä—Ç–∏ –æ—Ç —Å—Ç–∞—Ä–æ—Å—Ç–∏":
- –£–±–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã—Ö/–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∏—Ö –ø–∞–º—è—Ç—å + pending allocation
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫—Ä—É–≥–æ–≤–æ—Ä–æ—Ç –ø–æ–∫–æ–ª–µ–Ω–∏–π

### 7.2. –ê–ª–≥–æ—Ä–∏—Ç–º (Age-Based + Lazy Deletion + Safe Cleanup)

```java
public Organism reap() {
    while (!queue.isEmpty()) {
        Organism candidate = queue.poll();
        if (candidate.isAlive()) {
            candidate.kill();
            
            // Free pending allocation using allocId (safe)
            if (state.hasPendingAllocation()) {
                int allocId = state.getPendingAllocId();
                if (allocId >= 0) {
                    memoryManager.freeByAllocId(pendingAddr, pendingSize, allocId);
                } else {
                    memoryManager.freeIfOwned(pendingAddr, pendingSize);
                }
            }
            
            // Free organism memory using allocId (safe)
            int orgAllocId = org.getAllocId();
            if (orgAllocId >= 0) {
                memoryManager.freeByAllocId(org.addr, org.size, orgAllocId);
            } else {
                memoryManager.free(org.addr, org.size);
            }
            
            return candidate;
        }
        // Skip dead organisms (lazy deletion)
    }
    return null;
}

public int reapUntilFree(int size) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –∫–æ–≥–¥–∞ totalFree >= size (–¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å)
    // –ù–ï –∫–æ–≥–¥–∞ largestFree >= size (—ç—Ç–æ —É–±–∏–≤–∞–ª–æ –≤—Å–µ—Ö!)
    while (getFreeMemory() < size && !queue.isEmpty()) {
        reap();
    }
}
```

**Safe Cleanup:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `freeByAllocId()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
—Ç–æ–ª—å–∫–æ —è—á–µ–π–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –¥–∞–Ω–Ω–æ–º—É –æ—Ä–≥–∞–Ω–∏–∑–º—É, –∞ –Ω–µ —á—É–∂–∞—è –ø–∞–º—è—Ç—å.

### 7.3. –¢—Ä–∏–≥–≥–µ—Ä—ã

| –¢—Ä–∏–≥–≥–µ—Ä | –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç |
|---------|-------------------|
| **–ü–æ –ø–∞–º—è—Ç–∏** | `allocate()` –≤–µ—Ä–Ω—É–ª -1, `totalFree < size` |
| **–ü–æ –ø–æ–ø—É–ª—è—Ü–∏–∏** | `aliveCount >= maxOrganisms` |

---

## 8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### SimulatorStats

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `totalCycles` | –í—Å–µ–≥–æ —Ü–∏–∫–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ |
| `totalSpawns` | –£—Å–ø–µ—à–Ω—ã—Ö SPAWN |
| `rejectedSpawns` | –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã—Ö SPAWN (invalid addr/size) |
| `deathsByErrors` | –°–º–µ—Ä—Ç–µ–π –æ—Ç –æ—à–∏–±–æ–∫ |
| `deathsByReaper` | –°–º–µ—Ä—Ç–µ–π –æ—Ç –∂–Ω–µ—Ü–∞ |
| `aliveCount` | –ñ–∏–≤—ã—Ö —Å–µ–π—á–∞—Å |
| `maxAlive` | –ü–∏–∫–æ–≤–∞—è –ø–æ–ø—É–ª—è—Ü–∏—è |
| `memoryUsed` | –ó–∞–Ω—è—Ç–æ –ø–∞–º—è—Ç–∏ |
| `memoryLeak` | –£—Ç–µ—á–∫–∞: used - expected |
| `fragmentation` | –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è (0.0-1.0) |
| `defragmentations` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–π |
| `totalMutations` | –í—Å–µ–≥–æ –º—É—Ç–∞—Ü–∏–π |

### Memory Leak Detection

```java
int getExpectedMemoryUsed() {
    int orgSizes = 0;
    int pendingTotal = 0;
    
    for (Organism org : aliveOrganisms) {
        orgSizes += org.getSize();
        if (state.hasPendingAllocation()) {
            pendingTotal += state.getPendingAllocSize();
        }
    }
    
    // –í–ê–ñ–ù–û: –≤—ã—á–∏—Ç–∞–µ–º overlaps —á—Ç–æ–±—ã –Ω–µ —Å—á–∏—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã!
    int overlapCells = calculateOrgPendingOverlapCells();
    
    return orgSizes + pendingTotal - overlapCells;
}

int getMemoryLeak() {
    return memoryManager.getUsedMemory() - getExpectedMemoryUsed();
}
```

**Org-Pending Overlaps:**

–°–∏—Ç—É–∞—Ü–∏—è –∫–æ–≥–¥–∞ pending allocation –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º.
–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞:
1. –û—Ä–≥–∞–Ω–∏–∑–º A –¥–µ–ª–∞–µ—Ç ALLOCATE –ø–æ–ª—É—á–∞–µ—Ç [1000, 1014)
2. –î—Ä—É–≥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º B –∑–∞–Ω–∏–º–∞–µ—Ç [1000, 1014) (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ SPAWN)
3. Pending A –≤—Å—ë –µ—â—ë —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ [1000, 1014) ‚Äî overlap!

–ü—Ä–∏ –ø–æ–¥—Å—á—ë—Ç–µ `expected` —Ç–∞–∫–∏–µ —è—á–µ–π–∫–∏ —Å—á–∏—Ç–∞–ª–∏—Å—å –±—ã –¥–≤–∞–∂–¥—ã.
`calculateOrgPendingOverlapCells()` –≤—ã—á–∏—Ç–∞–µ—Ç —ç—Ç–∏ overlaps.

–ï—Å–ª–∏ `memoryLeak > 0` –ø—Ä–∏ `aliveCount = 0` ‚Äî –µ—Å—Ç—å —É—Ç–µ—á–∫–∞!

---

## 9. –ù–∞–±–ª—é–¥–∞–µ–º—ã–µ —Ñ–µ–Ω–æ–º–µ–Ω—ã

### 9.1. –ú—É—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –≥–µ–Ω–æ–º–∞

**–§–µ–Ω–æ–º–µ–Ω:** `MOVI R4, 14` –º—É—Ç–∏—Ä—É–µ—Ç –≤ `MOVI R4, 270` ‚Üí –æ—Ä–≥–∞–Ω–∏–∑–º —Å size=270!

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ (270 vs 14 cells)
- –ü—Ä–∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å—Å—è
- –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ ‚Äî —ç—Ç–æ "—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≥–µ–Ω–æ–º–∞"

### 9.2. Population Bottleneck

**–§–µ–Ω–æ–º–µ–Ω:** –ü–æ–ø—É–ª—è—Ü–∏—è 5000 ‚Üí 2 –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—ã—Å—è—á —Ü–∏–∫–ª–æ–≤.

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ª–µ—Ç–∞–ª—å–Ω—ã—Ö –º—É—Ç–∞—Ü–∏–π
- –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ
- –í—ã–∂–∏–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ "—á–∏—Å—Ç—ã–µ" –∏–ª–∏ —É–¥–∞—á–Ω–æ –º—É—Ç–∏—Ä–æ–≤–∞–≤—à–∏–µ

### 9.3. –ó–∞—Å—Ç–æ–π (Stasis)

**–§–µ–Ω–æ–º–µ–Ω:** spawns –∑–∞—Å—Ç—ã–≤–∞—é—Ç, –ø–æ–ø—É–ª—è—Ü–∏—è –º–µ–¥–ª–µ–Ω–Ω–æ —É–º–∏—Ä–∞–µ—Ç –æ—Ç –æ—à–∏–±–æ–∫.

**–ü—Ä–∏—á–∏–Ω–∞:** –í—Å–µ –∂–∏–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º—ã –∏–º–µ—é—Ç –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π –∫–æ–¥, –Ω–µ –º–æ–≥—É—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è.

---

## 10. CLI –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

```bash
# –°–±–æ—Ä–∫–∞
mvn clean package

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ wrapper (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./sim.sh [options]

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —Å –ª–∏–º–∏—Ç–æ–º –ø–∞–º—è—Ç–∏ (512MB ‚Äî VPS-—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ)
java -Xmx512m -XX:+UseG1GC -jar target/proteus-1.0.0-SNAPSHOT.jar run [options]

# –û–ø—Ü–∏–∏ run:
#   -c, --cycles         Max cycles (0 = infinite)
#   -s, --soup-size      Soup size (memory cells)
#   -m, --mutation-rate  Mutation rate (0.0-1.0)
#   --seed               Random seed for reproducibility
#   --max-organisms      Maximum living organisms
#   -q, --quiet          Quiet mode

# –ü—Ä–∏–º–µ—Ä—ã
java -jar proteus.jar run -c 5000000 -s 100000 --max-organisms 5000
java -jar proteus.jar run --seed 12345  # –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –∑–∞–ø—É—Å–∫

# –î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã
java -jar proteus.jar disassemble <file>
java -jar proteus.jar ancestor
java -jar proteus.jar info
```

### –≠–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### Mutation Rate

| Rate | –†–µ–∂–∏–º | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|-------|-----------|
| 0.1% | –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π | –°—Ç–∞–±–∏–ª—å–Ω–æ, –º–∞–ª–æ —ç–≤–æ–ª—é—Ü–∏–∏ |
| **0.2%** | **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π** | –ë–∞–ª–∞–Ω—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —ç–≤–æ–ª—é—Ü–∏–∏ |
| 0.5%+ | Error catastrophe | –í—ã–º–∏—Ä–∞–Ω–∏–µ |

#### –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ soup/organisms

**–§–æ—Ä–º—É–ª–∞:** `max_organisms ‚âà soup_size / avg_genome_size * 0.7`

| Soup size | Max organisms |
|-----------|---------------|
| 100K | 5,000 |
| 1M | 50,000 |

---

## 11. Roadmap

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (Stage 1-3: Core + Application)

- [x] ISA v1.1 ‚Üí v1.2 (Position-Independent Code)
- [x] VirtualCPU —Å –º—É—Ç–∞—Ü–∏—è–º–∏
- [x] Adam v3 (14 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, PIC)
- [x] MemoryManager (Free List + First Fit + Coalesce)
- [x] Reaper (Age-Based + Lazy Deletion)
- [x] Simulator + CLI (picocli)
- [x] Graceful shutdown, random seed
- [x] MutationTracker

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (Stage 3.5-3.6: PIC + Defragmentation)

- [x] GETADDR instruction
- [x] IP-relative JMP/JMPZ/JLT
- [x] startAddr-relative LOAD/STORE
- [x] Defragmenter (two-pass, all-or-nothing)
- [x] Pending allocation tracking
- [x] Memory leak detection
- [x] Performance: O(1) unregister (lazy deletion)
- [x] Performance: O(alive) parent search

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (Stage 4: Cleanup)

- [x] **Reaper Queue Cleanup** ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º—ë—Ä—Ç–≤—ã—Ö –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (lazy deletion)
- [x] **Heap Monitoring** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ JVM heap –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
- [x] **OOM Handling** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ OutOfMemoryError —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
- [x] **Memory Optimization** ‚Äî –∑–∞–º–µ–Ω–∏–ª–∏ `List<Organism> organisms` –Ω–∞ —Å—á—ë—Ç—á–∏–∫
- [x] **BitmapMemoryManager** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: single source of truth –¥–ª—è –ø–∞–º—è—Ç–∏

### üöß –í —Ä–∞–±–æ—Ç–µ (Stage 5: Tooling & Persistence)

**–¶–µ–ª—å:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞.

#### 5.1. ‚úÖ –ê—Å—Å–µ–º–±–ª–µ—Ä (—Ç–µ–∫—Å—Ç ‚Üí int[])
- [x] **Assembler** ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∞—Å—Å–µ–º–±–ª–µ—Ä–∞ –≤ –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö 17 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π ISA v1.2
  - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (`;` –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
  - –ú–µ—Ç–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (forward reference —Ä–∞–±–æ—Ç–∞–µ—Ç)
  - –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `.word` –¥–ª—è raw hex –∑–Ω–∞—á–µ–Ω–∏–π (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–∑–∏—Ç–æ–≤!)
  - –ö–æ–º–∞–Ω–¥–∞ CLI: `assemble <file.asm> -o <file.bin>`
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [docs/ASM_SPEC.md](docs/ASM_SPEC.md)

```asm
; –ü—Ä–∏–º–µ—Ä: –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º
start:
    GETADDR R7
    .word 0x0280FFFE    ; MOVI R4, 14 —Å "—Å–æ–ª—å—é" - –ø–∞—Ä–∞–∑–∏—Ç –Ω–µ –Ω–∞–π–¥—ë—Ç!
    ALLOCATE R4, R3
    JMP attack

template:
    MOVI R4, 14         ; –®–∞–±–ª–æ–Ω –¥–ª—è SEARCH (–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è)

attack:
    SEARCH R0, R1, R2, R3  ; –ù–∞–π—Ç–∏ –∂–µ—Ä—Ç–≤—É
    COPY R5, R3            ; –ê—Ç–∞–∫–æ–≤–∞—Ç—å!
```

#### 5.2. ‚úÖ Manual Deploy (inject organisms)
- [x] **Simulator.injectOrganism(genome, name)** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º –≤ —Ä–∞–±–æ—Ç–∞—é—â—É—é —Å–∏–º—É–ª—è—Ü–∏—é
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º—ë–Ω –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤ –¥–ª—è debug-–≤—ã–≤–æ–¥–∞
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FrameRecorder

#### 5.3. ‚úÖ Frame Recorder (debug mode)
- [x] **Frame** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞ (soup, organisms, events)
- [x] **FrameRecorder** ‚Äî –∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
- [x] **FramePrinter** ‚Äî –≤—ã–≤–æ–¥ —Ñ—Ä–µ–π–º–æ–≤ –≤ —á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ
- [x] –°–æ–±—ã—Ç–∏—è: Spawn, Death, Mutation, Allocation
- [x] CLI –∫–æ–º–∞–Ω–¥–∞: `proteus debug`
- [x] –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤: Adam#0, Adam#1, MyBot#5
- [x] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–∏–∫–ª–∞–º: `--from`, `--to`
- [x] –í—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª: `--output`

```bash
# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è debug —Ä–µ–∂–∏–º–∞:

# –ó–∞–ø–∏—Å–∞—Ç—å 40 —Ü–∏–∫–ª–æ–≤ —Å Adam'–æ–º (seed –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω!)
proteus debug --cycles 40

# –° —è–≤–Ω—ã–º seed –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
proteus debug --cycles 100 --seed 12345

# –ó–∞–ø–∏—Å–∞—Ç—å —Å –∏–Ω—ä–µ–∫—Ü–∏–µ–π —Å–≤–æ–µ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–º–∞
proteus debug --cycles 40 --inject examples/parasite.asm --name "MyParasite"

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏–∫–ª—ã 50-70 –∏–∑ 100
proteus debug --cycles 100 --from 50 --to 70

# –í—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª
proteus debug --cycles 200 --output debug.txt --seed 12345

# –¢–æ–ª—å–∫–æ —Å–≤–æ–¥–∫–∞ (—Ç–∞–±–ª–∏—Ü–∞)
proteus debug --cycles 100 --summary

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å checkpoint –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏
proteus debug --cycles 40 --save checkpoint.bin
```

**–í–∞–∂–Ω–æ –æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–µ:**
- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `--seed` –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- Seed –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ü—Ä–∏ `--resume` seed –±–µ—Ä—ë—Ç—Å—è –∏–∑ checkpoint, –ø–∞—Ä–∞–º–µ—Ç—Ä `--seed` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

#### 5.4. ‚úÖ Checkpoint (MVStore)
- [x] **CheckpointStore** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ H2 MVStore
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ
  - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ RNG state –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞
- [x] **--resume** –≤ debug –∏ run –∫–æ–º–∞–Ω–¥–∞—Ö
- [x] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ soup, –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤, CPU state, allocId

```java
// –§–æ—Ä–º–∞—Ç MVStore:
// "meta" map:
//   - version, cycles, seed, soup_size, org_count, stats, next_alloc_id
// "rng" map:
//   - state ‚Üí byte[] (GameRng state)
// "soup" map:
//   - startAddr ‚Üí int[] (non-zero regions)
// "organisms" map:
//   - orgId ‚Üí byte[] (serialized organism with allocId)
// "config" map:
//   - mutation_rate, max_errors, max_organisms
```

```bash
# Workflow —Å checkpoint:

# 1. Debug: —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º—ã, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
proteus debug --cycles 50 --inject bot.asm --save state.mv

# 2. Run: –∑–∞–ø—É—Å—Ç–∏—Ç—å "–≤–¥–æ–ª–≥—É—é" –±–µ–∑ debug-–≤—ã–≤–æ–¥–∞  
proteus run --resume state.mv --cycles 10000 --save state.mv

# 3. Debug: –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å
proteus debug --resume state.mv --cycles 100 --from 50

# –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø—Ä–∏ resume seed –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ checkpoint!
# –ü–∞—Ä–∞–º–µ—Ç—Ä --seed –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ --resume
```

**–í–∞–∂–Ω–æ –æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–µ:**
- –ü—Ä–∏ `--resume` —Å–æ—Å—Ç–æ—è–Ω–∏–µ RNG –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ
- allocId –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤ –∏ memory manager —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- nextAllocationId —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –Ω–æ–≤—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π
- –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ!

**–ü–æ–¥–∫–æ–º–∞–Ω–¥—ã checkpoint:**

```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ checkpoint —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–ø—É–ª—è—Ü–∏–∏
proteus checkpoint info state.mv

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö checkpoint (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞)
proteus checkpoint diff state1.mv state2.mv

# –î–∏–∑–∞—Å—Å–µ–º–±–ª–µ—Ä –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –ø–æ ID
proteus checkpoint dump state.mv 12345
proteus checkpoint dump state.mv 12345 -r -c  # raw codes + context
```

**–ê–Ω–∞–ª–∏–∑ –ø–æ–ø—É–ª—è—Ü–∏–∏ (`checkpoint info`):**
- `[R]` Reproductive ‚Äî –º–æ–∂–µ—Ç —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è (ALLOCATE + COPY + SPAWN)
- `[Z]` Zombie ‚Äî IP –≤—ã—à–µ–ª –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∫–æ–¥–∞
- `[L]` Looping ‚Äî –µ—Å—Ç—å JMP —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º offset
- `[P]` Pending ‚Äî –≥–æ—Ç–æ–≤–∏—Ç –ø–æ—Ç–æ–º–∫–∞
- `[E]` Erroring ‚Äî –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ (>50% –æ—Ç max)

#### 5.5. Memory Dump & Map API (multiplayer)
- [ ] **MemoryDump** ‚Äî —Å–Ω–∏–º–æ–∫ soup + ownership –ø–æ –∑–∞–ø—Ä–æ—Å—É –∏–≥—Ä–æ–∫–∞
  - –§–æ—Ä–º–∞—Ç: –±–∏–Ω–∞—Ä–Ω—ã–π soup + JSON —Å –æ—Ä–≥–∞–Ω–∏–∑–º–∞–º–∏
  - API: `GET /api/dump` ‚Üí —Å–∫–∞—á–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- [ ] **MapSnapshot** ‚Äî –∫–∞—Ä—Ç–∞ ownership –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
  - –†–∞–∑ –≤ N –º–∏–Ω—É—Ç: ownership[] ‚Üí player mapping
  - API: `GET /api/map` ‚Üí —Ç–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)
- [x] **–£–¥–∞–ª—ë–Ω FreeListMemoryManager** ‚Äî —É–ø—Ä–æ—Å—Ç–∏–ª–∏ –∫–æ–¥, —Ç–æ–ª—å–∫–æ BitmapMemoryManager
- [x] **Defragmenter** ‚Äî —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å BitmapMemoryManager (–±–µ–∑ instanceof)
- [x] **allocId Tracking** ‚Äî –∫–∞–∂–¥–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è, pending –∏ –æ—Ä–≥–∞–Ω–∏–∑–º –∏–º–µ—é—Ç allocId –¥–ª—è safe cleanup
- [x] **freeByAllocId()** ‚Äî –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö —è—á–µ–µ–∫, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç corruption
- [x] **Memory Leak Detection** ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç org-pending overlaps –≤ —Ñ–æ—Ä–º—É–ª–µ expected
- [x] **Next-Fit Allocator** ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç O(n) –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é –ø—Ä–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

### üìã –ü–ª–∞–Ω—ã (Stage 6+: Multiplayer)

- [ ] **Web UI** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è soup –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  - BitmapMemoryManager.ownership[] ‚Üí canvas/WebGL
  - –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ = —Å–≤–æ–π —Ü–≤–µ—Ç
  - WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [ ] **Player System** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–∏–º–∏—Ç—ã –¥–µ–ø–ª–æ—è, —Å–µ–∑–æ–Ω—ã
- [ ] **Competition Metrics** ‚Äî —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è, –≤—ã–∂–∏–≤–∞–µ–º–æ—Å—Ç—å, –ø–æ—Ç–æ–º–∫–∏
- [ ] **Genealogy Tracking** ‚Äî —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤
- [ ] **Diversity Metrics** ‚Äî —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≥–µ–Ω–æ–º–æ–≤

---

## –°—Å—ã–ª–∫–∏

- [Tierra (Wikipedia)](https://en.wikipedia.org/wiki/Tierra_(computer_simulation))
- [Avida](https://en.wikipedia.org/wiki/Avida) ‚Äî —Ä–∞–∑–≤–∏—Ç–∏–µ –∏–¥–µ–π Tierra
- [ISA_SPEC.md](ISA_SPEC.md) ‚Äî –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
